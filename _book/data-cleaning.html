<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Data Cleaning | biometry</title>
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 4 Data Cleaning | biometry">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Data Cleaning | biometry">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<meta name="description" content="Main actions are select(), filter(), group_by(), mutate(), summarise(), full_join(), pivot_wide() and pivot_long(), spread(), map(), strsplit(), broom() library(tidyverse) #&gt; ── Attaching packages...">
<meta property="og:description" content="Main actions are select(), filter(), group_by(), mutate(), summarise(), full_join(), pivot_wide() and pivot_long(), spread(), map(), strsplit(), broom() library(tidyverse) #&gt; ── Attaching packages...">
<meta name="twitter:description" content="Main actions are select(), filter(), group_by(), mutate(), summarise(), full_join(), pivot_wide() and pivot_long(), spread(), map(), strsplit(), broom() library(tidyverse) #&gt; ── Attaching packages...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> r Basics</a></li>
<li><a class="" href="data-handling.html"><span class="header-section-number">3</span> Data Handling</a></li>
<li><a class="active" href="data-cleaning.html"><span class="header-section-number">4</span> Data Cleaning</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/drkmenon/biometry">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-cleaning" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Data Cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"><i class="fas fa-link"></i></a>
</h1>
<p>Main actions are select(), filter(), group_by(), mutate(), summarise(),
full_join(), pivot_wide() and pivot_long(), spread(), map(), strsplit(), broom()</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.5     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.5     ✓ dplyr   1.0.7</span>
<span class="co">#&gt; ✓ tidyr   1.1.4     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   2.0.2     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></code></pre></div>
<p>Use read_csv/read_tsv insted of read.csv
This will create tibble insted of data frame</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span><span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">'data/bookings.csv'</span><span class="op">)</span>
<span class="co">#&gt; Rows: 10000 Columns: 8</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (3): booker_id, checkin_day, status</span>
<span class="co">#&gt; dbl (4): property_id, room_nights, price_per_night, revi...</span>
<span class="co">#&gt; lgl (1): for_business</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>
<span class="va">property</span><span class="op">=</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">'data/properties.csv'</span><span class="op">)</span>
<span class="co">#&gt; Rows: 4178 Columns: 5</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (3): destination, property_type, facilities</span>
<span class="co">#&gt; dbl (2): property_id, nr_rooms</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="va">booking</span>
<span class="co">#&gt; # A tibble: 10,000 × 8</span>
<span class="co">#&gt;    booker_id         property_id room_nights price_per_night</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 215934017ba98c09…        2668           4            91.5</span>
<span class="co">#&gt;  2 7f590fd6d318248a…        4656           5           107. </span>
<span class="co">#&gt;  3 10f0f138e8bb1015…        4563           6            87.0</span>
<span class="co">#&gt;  4 7b55021a4160dde6…        4088           7            92.4</span>
<span class="co">#&gt;  5 6694a79d158c7818…        2188           4           105. </span>
<span class="co">#&gt;  6 d0358740d5f15e85…        4171           2           110. </span>
<span class="co">#&gt;  7 944e568a0b511b91…        2907           4           116. </span>
<span class="co">#&gt;  8 95476c2ef6bb9e3c…        5141           4           111. </span>
<span class="co">#&gt;  9 df235631a4c281c0…        1696           1           106. </span>
<span class="co">#&gt; 10 ff610140227d40d2…        1901           7            82.3</span>
<span class="co">#&gt; # … with 9,990 more rows, and 4 more variables:</span>
<span class="co">#&gt; #   checkin_day &lt;chr&gt;, for_business &lt;lgl&gt;, status &lt;chr&gt;,</span>
<span class="co">#&gt; #   review_score &lt;dbl&gt;</span>
<span class="va">property</span>
<span class="co">#&gt; # A tibble: 4,178 × 5</span>
<span class="co">#&gt;    property_id destination property_type nr_rooms facilities</span>
<span class="co">#&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt;  1        2668 Brisbane    Hotel               32 airport s…</span>
<span class="co">#&gt;  2        4656 Brisbane    Hotel               39 on-site r…</span>
<span class="co">#&gt;  3        4563 Brisbane    Apartment            9 laundry   </span>
<span class="co">#&gt;  4        4088 Brisbane    Apartment            9 kitchen,l…</span>
<span class="co">#&gt;  5        2188 Brisbane    Apartment            4 parking,k…</span>
<span class="co">#&gt;  6        4171 Brisbane    Apartment            5 kitchen,p…</span>
<span class="co">#&gt;  7        2907 Brisbane    Hotel               22 airport s…</span>
<span class="co">#&gt;  8        5141 Brisbane    Hotel               20 breakfast…</span>
<span class="co">#&gt;  9        1696 Brisbane    Apartment            5 free wifi…</span>
<span class="co">#&gt; 10        1901 Brisbane    Apartment           11 free wifi…</span>
<span class="co">#&gt; # … with 4,168 more rows</span></code></pre></div>
<p>magrittr (pipe function, keyboard short cut: command+shift+m)
%&gt;%
select() and filter() functions help to extract data and study it</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">=</span><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">review_score</span><span class="op">)</span>
<span class="va">x</span>  
<span class="co">#&gt; # A tibble: 10,000 × 1</span>
<span class="co">#&gt;    review_score</span>
<span class="co">#&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1        NA   </span>
<span class="co">#&gt;  2        NA   </span>
<span class="co">#&gt;  3         6.26</span>
<span class="co">#&gt;  4         5.95</span>
<span class="co">#&gt;  5         6.43</span>
<span class="co">#&gt;  6        NA   </span>
<span class="co">#&gt;  7         7.60</span>
<span class="co">#&gt;  8        NA   </span>
<span class="co">#&gt;  9         6.97</span>
<span class="co">#&gt; 10        NA   </span>
<span class="co">#&gt; # … with 9,990 more rows</span>

<span class="va">y</span><span class="op">=</span><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">status</span><span class="op">==</span><span class="st">'stayed'</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_score</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span>
<span class="co">#&gt; # A tibble: 6,183 × 8</span>
<span class="co">#&gt;    booker_id         property_id room_nights price_per_night</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 10f0f138e8bb1015…        4563           6            87.0</span>
<span class="co">#&gt;  2 7b55021a4160dde6…        4088           7            92.4</span>
<span class="co">#&gt;  3 6694a79d158c7818…        2188           4           105. </span>
<span class="co">#&gt;  4 944e568a0b511b91…        2907           4           116. </span>
<span class="co">#&gt;  5 df235631a4c281c0…        1696           1           106. </span>
<span class="co">#&gt;  6 5a1442f4c7237ec5…        2307           9            84.2</span>
<span class="co">#&gt;  7 39804a2e3fb2e4c6…        2907           6           112. </span>
<span class="co">#&gt;  8 e150e559405ef29b…        2870           4           127. </span>
<span class="co">#&gt;  9 4e9c7c21dfcf2758…        1674           5           102. </span>
<span class="co">#&gt; 10 4a2b8eaf63613548…        2885           5            86.3</span>
<span class="co">#&gt; # … with 6,173 more rows, and 4 more variables:</span>
<span class="co">#&gt; #   checkin_day &lt;chr&gt;, for_business &lt;lgl&gt;, status &lt;chr&gt;,</span>
<span class="co">#&gt; #   review_score &lt;dbl&gt;</span>

<span class="va">cheap</span><span class="op">=</span><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">review_score</span>,<span class="va">room_nights</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">booking</span><span class="op">$</span><span class="va">price_per_night</span><span class="op">&lt;</span><span class="fl">80</span><span class="op">)</span>
<span class="va">cheap</span>
<span class="co">#&gt; # A tibble: 434 × 2</span>
<span class="co">#&gt;    review_score room_nights</span>
<span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1         8.90           5</span>
<span class="co">#&gt;  2         5.87           6</span>
<span class="co">#&gt;  3        NA              4</span>
<span class="co">#&gt;  4        NA              7</span>
<span class="co">#&gt;  5         6.02           4</span>
<span class="co">#&gt;  6         9.64           6</span>
<span class="co">#&gt;  7        NA              3</span>
<span class="co">#&gt;  8        NA              4</span>
<span class="co">#&gt;  9         6.23           5</span>
<span class="co">#&gt; 10        NA              2</span>
<span class="co">#&gt; # … with 424 more rows</span>


<span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">checkin_day</span><span class="op">==</span><span class="st">'wed'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">property_id</span>,<span class="va">status</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 2</span>
<span class="co">#&gt;   property_id status   </span>
<span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt; 1        4563 stayed   </span>
<span class="co">#&gt; 2        5141 cancelled</span></code></pre></div>
<p>ggplot2: for plotting
ggplot(aes()+geom_histogram()/geom_point()….</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">review_score</span><span class="op">)</span>
  <span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 3817 rows containing non-finite values</span>
<span class="co">#&gt; (stat_bin).</span></code></pre></div>
<div class="inline-figure"><img src="1.3-dclean_files/figure-html/unnamed-chunk-4-1.png" width="100%"></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">price_per_night</span>,<span class="va">review_score</span><span class="op">)</span>
  <span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 3817 rows containing missing values</span>
<span class="co">#&gt; (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="1.3-dclean_files/figure-html/unnamed-chunk-4-2.png" width="100%"></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">room_nights</span><span class="op">&gt;</span><span class="fl">7</span>, <span class="va">status</span><span class="op">==</span><span class="st">'stayed'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">price_per_night</span>,<span class="va">review_score</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">price_per_night</span>,<span class="va">review_score</span><span class="op">)</span>
  <span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 41 rows containing missing values</span>
<span class="co">#&gt; (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="1.3-dclean_files/figure-html/unnamed-chunk-4-3.png" width="100%"></div>
<p>mutate</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>centered_mean<span class="op">=</span><span class="va">price_per_night</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price_per_night</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 9</span>
<span class="co">#&gt;   booker_id          property_id room_nights price_per_night</span>
<span class="co">#&gt;   &lt;chr&gt;                    &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 215934017ba98c09f…        2668           4            91.5</span>
<span class="co">#&gt; 2 7f590fd6d318248a4…        4656           5           107. </span>
<span class="co">#&gt; # … with 5 more variables: checkin_day &lt;chr&gt;,</span>
<span class="co">#&gt; #   for_business &lt;lgl&gt;, status &lt;chr&gt;, review_score &lt;dbl&gt;,</span>
<span class="co">#&gt; #   centered_mean &lt;dbl&gt;</span></code></pre></div>
<p>summarise: extracts the number of variables</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>
    , n_miss<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_score</span><span class="op">)</span><span class="op">)</span>
    ,mean_score<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">review_score</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 3</span>
<span class="co">#&gt;   `n()` n_miss mean_score</span>
<span class="co">#&gt;   &lt;int&gt;  &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 10000   3817       7.22</span>

<span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>
    , stayed_booking<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">status</span><span class="op">==</span><span class="st">'stayed'</span><span class="op">)</span>
    , mean_total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price_per_night</span><span class="op">*</span><span class="va">room_nights</span><span class="op">)</span>                   
    
  <span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 3</span>
<span class="co">#&gt;   `n()` stayed_booking mean_total</span>
<span class="co">#&gt;   &lt;int&gt;          &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 10000           7775       348.</span></code></pre></div>
<p>group by</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>
    <span class="va">for_business</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>
    , mean_review<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">review_score</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt;   for_business     n mean_review</span>
<span class="co">#&gt;   &lt;lgl&gt;        &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 FALSE         6285        7.50</span>
<span class="co">#&gt; 2 TRUE          3715        6.85</span>

<span class="va">mixed</span><span class="op">=</span><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">property</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">destination</span>,<span class="va">checkin_day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    names_from <span class="op">=</span> <span class="va">checkin_day</span>,values_from <span class="op">=</span> <span class="va">n</span>
  <span class="op">)</span>
<span class="co">#&gt; Joining, by = "property_id"</span>
<span class="va">mixed</span> 
<span class="co">#&gt; # A tibble: 3 × 8</span>
<span class="co">#&gt;   destination   fri   mon   sat   sun   thu   tue   wed</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Amsterdam    1074   517   889   813   667   498   542</span>
<span class="co">#&gt; 2 Brisbane      162   133   114   153   162   148   128</span>
<span class="co">#&gt; 3 Tokyo         451   718   322   576   718   655   560</span></code></pre></div>
<p>make a long data form</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">long</span><span class="op">=</span><span class="va">mixed</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">8</span>, names_to <span class="op">=</span> <span class="st">'day'</span>,values_to <span class="op">=</span> <span class="st">'count'</span><span class="op">)</span>
<span class="va">long</span>
<span class="co">#&gt; # A tibble: 21 × 3</span>
<span class="co">#&gt;    destination day   count</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 Amsterdam   fri    1074</span>
<span class="co">#&gt;  2 Amsterdam   mon     517</span>
<span class="co">#&gt;  3 Amsterdam   sat     889</span>
<span class="co">#&gt;  4 Amsterdam   sun     813</span>
<span class="co">#&gt;  5 Amsterdam   thu     667</span>
<span class="co">#&gt;  6 Amsterdam   tue     498</span>
<span class="co">#&gt;  7 Amsterdam   wed     542</span>
<span class="co">#&gt;  8 Brisbane    fri     162</span>
<span class="co">#&gt;  9 Brisbane    mon     133</span>
<span class="co">#&gt; 10 Brisbane    sat     114</span>
<span class="co">#&gt; # … with 11 more rows</span></code></pre></div>
<p>make long data form</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wide</span><span class="op">=</span> <span class="va">long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"day"</span>, values_from <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="va">wide</span>
<span class="co">#&gt; # A tibble: 3 × 8</span>
<span class="co">#&gt;   destination   fri   mon   sat   sun   thu   tue   wed</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Amsterdam    1074   517   889   813   667   498   542</span>
<span class="co">#&gt; 2 Brisbane      162   133   114   153   162   148   128</span>
<span class="co">#&gt; 3 Tokyo         451   718   322   576   718   655   560</span></code></pre></div>
<p>Boxplot with ggplot2</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">booking</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      <span class="va">review_score</span>,<span class="va">for_business</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 3817 rows containing non-finite values</span>
<span class="co">#&gt; (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="1.3-dclean_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<p>hash the property id
we need to know map()function to do this. map(x,~.), where x = object and ~. is a function which goes through each vector</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eddelbuettel/digest">digest</a></span><span class="op">)</span>

<span class="va">property</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>property_id<span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">property_id</span>,<span class="va">digest</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,178 × 5</span>
<span class="co">#&gt;    property_id destination property_type nr_rooms facilities</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt;  1 c5fe5a36c3… Brisbane    Hotel               32 airport s…</span>
<span class="co">#&gt;  2 6abfc65c14… Brisbane    Hotel               39 on-site r…</span>
<span class="co">#&gt;  3 8740143b90… Brisbane    Apartment            9 laundry   </span>
<span class="co">#&gt;  4 e30b95c1ec… Brisbane    Apartment            9 kitchen,l…</span>
<span class="co">#&gt;  5 ab19240af8… Brisbane    Apartment            4 parking,k…</span>
<span class="co">#&gt;  6 b2efd881c3… Brisbane    Apartment            5 kitchen,p…</span>
<span class="co">#&gt;  7 d49c23b12c… Brisbane    Hotel               22 airport s…</span>
<span class="co">#&gt;  8 1fd9f14595… Brisbane    Hotel               20 breakfast…</span>
<span class="co">#&gt;  9 7319c32a43… Brisbane    Apartment            5 free wifi…</span>
<span class="co">#&gt; 10 a38cc66d5f… Brisbane    Apartment           11 free wifi…</span>
<span class="co">#&gt; # … with 4,168 more rows</span></code></pre></div>
<p>list in data frame
If we have a column with multiple strings, we can split it in to vectors using strsplit()</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">property</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>facilities<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">facilities</span>,<span class="st">","</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,178 × 5</span>
<span class="co">#&gt;    property_id destination property_type nr_rooms facilities</span>
<span class="co">#&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt; &lt;list&gt;    </span>
<span class="co">#&gt;  1        2668 Brisbane    Hotel               32 &lt;chr [6]&gt; </span>
<span class="co">#&gt;  2        4656 Brisbane    Hotel               39 &lt;chr [7]&gt; </span>
<span class="co">#&gt;  3        4563 Brisbane    Apartment            9 &lt;chr [1]&gt; </span>
<span class="co">#&gt;  4        4088 Brisbane    Apartment            9 &lt;chr [3]&gt; </span>
<span class="co">#&gt;  5        2188 Brisbane    Apartment            4 &lt;chr [5]&gt; </span>
<span class="co">#&gt;  6        4171 Brisbane    Apartment            5 &lt;chr [6]&gt; </span>
<span class="co">#&gt;  7        2907 Brisbane    Hotel               22 &lt;chr [8]&gt; </span>
<span class="co">#&gt;  8        5141 Brisbane    Hotel               20 &lt;chr [8]&gt; </span>
<span class="co">#&gt;  9        1696 Brisbane    Apartment            5 &lt;chr [6]&gt; </span>
<span class="co">#&gt; 10        1901 Brisbane    Apartment           11 &lt;chr [8]&gt; </span>
<span class="co">#&gt; # … with 4,168 more rows</span>
<span class="va">property</span><span class="op">$</span><span class="va">facilities</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt; [1] "airport shuttle,free wifi,garden,breakfast,pool,on-site restaurant"</span></code></pre></div>
<p>add a column with the number of facilities</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">property</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>facilities<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">facilities</span>,<span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_facility<span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">facilities</span>,<span class="va">length</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,178 × 6</span>
<span class="co">#&gt;    property_id destination property_type nr_rooms facilities</span>
<span class="co">#&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt; &lt;list&gt;    </span>
<span class="co">#&gt;  1        2668 Brisbane    Hotel               32 &lt;chr [6]&gt; </span>
<span class="co">#&gt;  2        4656 Brisbane    Hotel               39 &lt;chr [7]&gt; </span>
<span class="co">#&gt;  3        4563 Brisbane    Apartment            9 &lt;chr [1]&gt; </span>
<span class="co">#&gt;  4        4088 Brisbane    Apartment            9 &lt;chr [3]&gt; </span>
<span class="co">#&gt;  5        2188 Brisbane    Apartment            4 &lt;chr [5]&gt; </span>
<span class="co">#&gt;  6        4171 Brisbane    Apartment            5 &lt;chr [6]&gt; </span>
<span class="co">#&gt;  7        2907 Brisbane    Hotel               22 &lt;chr [8]&gt; </span>
<span class="co">#&gt;  8        5141 Brisbane    Hotel               20 &lt;chr [8]&gt; </span>
<span class="co">#&gt;  9        1696 Brisbane    Apartment            5 &lt;chr [6]&gt; </span>
<span class="co">#&gt; 10        1901 Brisbane    Apartment           11 &lt;chr [8]&gt; </span>
<span class="co">#&gt; # … with 4,168 more rows, and 1 more variable:</span>
<span class="co">#&gt; #   n_facility &lt;int&gt;</span></code></pre></div>

</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-handling.html"><span class="header-section-number">3</span> Data Handling</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li><a class="nav-link" href="#data-cleaning"><span class="header-section-number">4</span> Data Cleaning</a></li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/drkmenon/biometry/blob/master/1.3-dclean.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/drkmenon/biometry/edit/master/1.3-dclean.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong></strong>" was written by . </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
